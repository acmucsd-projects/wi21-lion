<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: article/SectionContent.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: article/SectionContent.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useCallback, useContext, useEffect, useState } from 'react';
import * as Add2Calendar from "add2calendar"
import 'add2calendar/css/add2calendar.css'

import LinksPanel from './LinksPanel';

import './Article.css';
import { EnrollDialog, LoginDialog } from '../popups/dialogs';
import { EditSection } from './EditArticle';
import { UserContext } from '../contexts/UserContext';


function getLectureDays(lecture_times) {
    const days = lecture_times.split(" ")[0];
    let lectureTimeData = {
        "monday": false,
        "tuesday": false,
        "wednesday": false,
        "thursday": false,
        "friday": false
    };
    if (days.includes("M")) {
        lectureTimeData.monday = true;
    }
    if (days.includes("Tu")) {
        lectureTimeData.tuesday = true;
    }
    if (days.includes("W")) {
        lectureTimeData.wednesday = true;
    }
    if (days.includes("Th")) {
        lectureTimeData.thursday = true;
    }
    if (days.includes("F")) {
        lectureTimeData.friday = true;
    }
    return lectureTimeData;
}

function getLectureTimes(lecture_times) {
    const times = lecture_times.split(" ")[1];
    const firstTime = times.split("-")[0];
    const firstIsPM = firstTime.includes("PM");
    const secondTime = times.split("-")[1];
    const secondIsPM = secondTime.includes("PM");
    const firstHour = firstTime.split(":")[0];
    const firstMin = firstTime.split(":")[1].substring(0, 2);
    const secondHour = secondTime.split(":")[0];
    const secondMin = secondTime.split(":")[1].substring(0, 2);

    let startPos = (firstHour * 50) + (firstMin * 55 / 60);
    let endPos = (secondHour * 50) + (secondMin * 55 / 60);

    if (firstIsPM) {
        startPos += 50 * 13;
    }
    if (secondIsPM) {
        endPos += 50 * 13;
    }
    if (firstHour === "12") {
        startPos = 0;
    }

    return {
        top: startPos,
        height: (endPos - startPos)
    }
}


const SectionSchedule = ({ course, section }) => {

    const [days, setDays] = useState({
        "monday": false,
        "tuesday": false,
        "wednesday": false,
        "thursday": false,
        "friday": false
    });

    const [eventPos, setEventPos] = useState({
        top: "0px",
        height: "0px"
    });

    // const lecture_times = "MWF 10:00AM-11:45AM";

    useEffect(() => {
        if (section &amp;&amp; section.lecture_times) {
            setDays(getLectureDays(section.lecture_times));
            setEventPos(getLectureTimes(section.lecture_times));
        }
    }, [section, section.lecture_times])

    return (
        &lt;div className="schedule-container section-schedule">
            &lt;TimeSchedule />
            &lt;SectionScheduleDay showEvent={days.monday} pos={eventPos} course={course} section={section}>Monday&lt;/SectionScheduleDay>
            &lt;SectionScheduleDay showEvent={days.tuesday} pos={eventPos} course={course} section={section}>Tuesday&lt;/SectionScheduleDay>
            &lt;SectionScheduleDay showEvent={days.wednesday} pos={eventPos} course={course} section={section}>Wednesday&lt;/SectionScheduleDay>
            &lt;SectionScheduleDay showEvent={days.thursday} pos={eventPos} course={course} section={section}>Thursday&lt;/SectionScheduleDay>
            &lt;SectionScheduleDay showEvent={days.friday} pos={eventPos} course={course} section={section}>Friday&lt;/SectionScheduleDay>
        &lt;/div>
    );
}

const AddToCalendarDialog = ({ pos, course, section, day }) => {
    // get next day of the week
    let nextDate = new Date();
    nextDate.setDate(nextDate.getDate() + (day + 7 - nextDate.getDay()) % 7);
    var months = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    const startTime = section.lecture_times.split(" ")[1].split("-")[0];
    const endTime = section.lecture_times.split(" ")[1].split("-")[1];
    let startTimeString = "";
    if (startTime.length === 7) {
        startTimeString = `${months[nextDate.getMonth()]} ${nextDate.getDate()}, ${nextDate.getFullYear()} ${startTime.substring(0, 5)} ${startTime.substring(5, 8)}`;
    } else {
        startTimeString = `${months[nextDate.getMonth()]} ${nextDate.getDate()}, ${nextDate.getFullYear()} ${startTime.substring(0, 4)} ${startTime.substring(4, 7)}`;
    }
    let endTimeString = "";
    if (endTime.length === 7) {
        endTimeString = `${months[nextDate.getMonth()]} ${nextDate.getDate()}, ${nextDate.getFullYear()} ${endTime.substring(0, 5)} ${endTime.substring(5, 8)}`;
    } else {
        endTimeString = `${months[nextDate.getMonth()]} ${nextDate.getDate()}, ${nextDate.getFullYear()} ${endTime.substring(0, 4)} ${endTime.substring(4, 7)}`;
    }
    var singleEventArgs = {
        title: `${course.name} Lecture`,
        start: startTimeString,
        end: endTimeString,
        location: 'UCSD',
        description: `${course.name} - ${section.quarter} ${section.year} - ${section.professor}`,
        isAllDay: false,
    };

    var singleEvent = new Add2Calendar(singleEventArgs);

    const googleUrl = singleEvent.getGoogleUrl();
    const iCalUrl = singleEvent.getICalUrl();
    // const outlookUrl = singleEvent.getOutlookUrl(); 
    // const yahooUrl = singleEvent.getYahooUrl(); 

    return (
        &lt;div className="add-to-calendar-dialog" style={{ top: pos }}>
            Add To:
            &lt;a href={googleUrl}>Google Calendar&lt;/a>
            &lt;a href={iCalUrl}>Apple Calendar&lt;/a>
        &lt;/div>
    )
}

const SectionScheduleDay = (props) => {

    const { showEvent, pos, course, section } = props
    const [displayAddToCalendar, setDisplayAddToCalendar] = useState(false);

    function toggleAddToCalendar() {
        setDisplayAddToCalendar(!displayAddToCalendar);
    }


    const today = new Date().getDay();
    let day = 0;
    switch (props.children) {
        case "Monday":
            day = 1;
            break;
        case "Tuesday":
            day = 2;
            break;
        case "Wednesday":
            day = 3;
            break;
        case "Thursday":
            day = 4;
            break;
        case "Friday":
            day = 5;
            break;
        default:
            break;
    }
    return (
        &lt;div style={{ textAlign: 'center', position: 'relative' }}>
            {props.children}
            &lt;div style={{ backgroundColor: today === day ? '#ade6e6' : 'white' }} className="schedule-wrapper">
                {showEvent &amp;&amp; &lt;div style={{ top: pos.top, height: pos.height }} className="schedule-event" onClick={toggleAddToCalendar}>{course.name} Lecture&lt;/div>}
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
                &lt;div>&lt;/div>
            &lt;/div>
            &lt;div onClick={toggleAddToCalendar}>
                {displayAddToCalendar &amp;&amp; &lt;AddToCalendarDialog pos={pos.top} course={course} section={section} day={day} />}
            &lt;/div>
        &lt;/div>
    );
}

const TimeSchedule = () => {

    return (
        &lt;div style={{ textAlign: 'center' }}>
            Hour
            &lt;div className="schedule-wrapper">
                &lt;div>12:00 AM&lt;/div>
                &lt;div>1:00 AM&lt;/div>
                &lt;div>2:00 AM&lt;/div>
                &lt;div>3:00 AM&lt;/div>
                &lt;div>4:00 AM&lt;/div>
                &lt;div>5:00 AM&lt;/div>
                &lt;div>6:00 AM&lt;/div>
                &lt;div>7:00 AM&lt;/div>
                &lt;div>8:00 AM&lt;/div>
                &lt;div>9:00 AM&lt;/div>
                &lt;div>10:00 AM&lt;/div>
                &lt;div>11:00 AM&lt;/div>
                &lt;div>12:00 PM&lt;/div>
                &lt;div>1:00 PM&lt;/div>
                &lt;div>2:00 PM&lt;/div>
                &lt;div>3:00 PM&lt;/div>
                &lt;div>4:00 PM&lt;/div>
                &lt;div>5:00 PM&lt;/div>
                &lt;div>6:00 PM&lt;/div>
                &lt;div>7:00 PM&lt;/div>
                &lt;div>8:00 PM&lt;/div>
                &lt;div>9:00 PM&lt;/div>
                &lt;div>10:00 PM&lt;/div>
                &lt;div>11:00 PM&lt;/div>
            &lt;/div>
        &lt;/div>
    );
}

/**
 * React component for each courses' sections 
 * @param {*} props 
 */
function SectionContent(props) {
    const { section, course, fetchSectionData } = props;
    const [displayEnrollDialog, setDisplayEnrollDialog] = useState(false);
    const [displayEditSection, setDisplayEditSection] = useState(false);
    const [displayLoginPrompt, setDisplayLoginPrompt] = useState(false);
    const [isEnrolled, setIsEnrolled] = useState(false);
    const { user } = useContext(UserContext);

    function showEnrollDialog() {
        setDisplayEnrollDialog(true);
    }

    function hideEnrollDialog() {
        setDisplayEnrollDialog(false);
    }

    function showEditSection() {
        setDisplayEditSection(true);
    }

    function hideEditSection() {
        setDisplayEditSection(false);
    }

    function showLogin() {
        setDisplayLoginPrompt(true);
    }

    function hideLogin() {
        setDisplayLoginPrompt(false);
    }

    function handleClickOff(event) {
        if (event.target.className === "edit-backdrop") {
            setDisplayEditSection(false);
        }
    }

    const updateIsEnrolled = useCallback(() => {
        if (user.enrolled_sections) {
            user.enrolled_sections.forEach(element => {
                fetch(`http://localhost:5000/enrolled_section/${element}`, {
                    headers: {
                        'auth_token': user.token
                    }
                })
                    .then(response => response.json())
                    .then(enrolled_section => {
                        fetch(`http://localhost:5000/section/${enrolled_section.section_id}`)
                            .then(response => response.json())
                            .then(sectionData => {
                                if (sectionData._id === section._id) {
                                    setIsEnrolled(true);
                                }
                            })
                    })
            });
        }

    }, [section._id, user.enrolled_sections, user.token])


    useEffect(() => {
        updateIsEnrolled();
    }, [user, updateIsEnrolled])


    return (
        &lt;div>
            &lt;div className="section-content-header article-body">
                &lt;h1>{course.name}: {section.professor}&lt;/h1>
                {user &amp;&amp; user.token &amp;&amp; &lt;button className="edit-button" onClick={showEditSection}>
                    &lt;span>Edit&lt;/span>
                &lt;/button>}
                {(!user || !user.token) &amp;&amp; &lt;h3 onClick={showLogin} className="enroll-button">Login to Edit&lt;/h3>}
            &lt;/div>
            &lt;div id="section-content">
                &lt;div id="top-section-content">
                    &lt;div>
                        &lt;div id="section-info">
                            &lt;h3>Section: &lt;span>{section.section_id}&lt;/span>&lt;/h3>
                            &lt;h3>Instructor: &lt;span>{section.professor}&lt;/span>&lt;/h3>
                            &lt;h3>Lecture: &lt;span>{section.lecture_times}&lt;/span>&lt;/h3>
                        &lt;/div>
                        &lt;p className="section-description">
                            {section.description}
                        &lt;/p>
                    &lt;/div>
                    &lt;div>
                        {user &amp;&amp; user.token &amp;&amp; !isEnrolled &amp;&amp; &lt;button className="enroll-button" onClick={showEnrollDialog}>
                            &lt;span>Enroll&lt;/span>
                        &lt;/button>}
                        {user &amp;&amp; user.token &amp;&amp; isEnrolled &amp;&amp; &lt;h3 className="enrolled">
                            {"\u2705"} Enrolled &lt;/h3>
                        }
                        {(!user || !user.token) &amp;&amp; &lt;h3 onClick={showLogin} className="enroll-button">Login to Enroll&lt;/h3>}
                        &lt;LinksPanel section={section} />
                    &lt;/div>
                &lt;/div>
                &lt;h2 className="section-schedule">Schedule:&lt;/h2>
                &lt;SectionSchedule course={course} section={section} />
            &lt;/div>
            &lt;div className="enroll-dialog-wrapper">
                {displayEnrollDialog &amp;&amp; &lt;EnrollDialog show={showEnrollDialog} hide={hideEnrollDialog} section={section} updateIsEnrolled={updateIsEnrolled} />}
            &lt;/div>
            {displayEditSection &amp;&amp;
                &lt;div className="edit-backdrop" onClick={handleClickOff}>
                    &lt;div className="edit-section-wrapper">
                        &lt;EditSection course={course} section={section} closeSectionEdit={hideEditSection} fetchSectionData={fetchSectionData} />
                    &lt;/div>
                &lt;/div>}
            &lt;div className="login-wrapper">
                {displayLoginPrompt &amp;&amp; &lt;LoginDialog show={showLogin} hide={hideLogin} />}
            &lt;/div>
        &lt;/div>
    );
}

export default SectionContent</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#CourseArticle">CourseArticle</a></li><li><a href="global.html#LinkEntry">LinkEntry</a></li><li><a href="global.html#LinksPanel">LinksPanel</a></li><li><a href="global.html#OrgArticle">OrgArticle</a></li><li><a href="global.html#PathItem">PathItem</a></li><li><a href="global.html#querySearch">querySearch</a></li><li><a href="global.html#SectionArticle">SectionArticle</a></li><li><a href="global.html#SectionContent">SectionContent</a></li><li><a href="global.html#updateSelectedArticleType">updateSelectedArticleType</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Wed Mar 31 2021 08:34:53 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
